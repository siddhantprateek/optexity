---
title: Assertion Actions Reference
description: Complete reference for assertion action schemas
---

This page documents assertion action types for verifying conditions during automation.

## AssertionAction

Container for all assertion types. Exactly one assertion type must be provided.

```python
from optexity.schema.actions.assertion_action import AssertionAction

AssertionAction(
    llm=...,           # Exactly one of these
    network_call=...,
    python_script=...,
)
```

### Assertion Types

Exactly one must be provided:

| Property | Type | Description |
|----------|------|-------------|
| `llm` | `LLMAssertion` | Verify conditions using an LLM |
| `network_call` | `NetworkCallAssertion` | Check network request/response |
| `python_script` | `PythonScriptAssertion` | Run custom verification code |

---

## LLMAssertion

Verify page conditions using an LLM.

```python
from optexity.schema.actions.assertion_action import LLMAssertion

LLMAssertion(
    source=["axtree"],
    output_format="str",
    extraction_instruction="Check if the login was successful",
)
```

### Properties

<ParamField path="source" type="list[Literal['axtree', 'screenshot']]" required>
  Data sources for the LLM to analyze:
  - `"axtree"`: Accessibility tree (structured text representation)
  - `"screenshot"`: Visual screenshot of the page
  
  Can include both: `["axtree", "screenshot"]`
</ParamField>

<ParamField path="output_format" type="str | BaseModel" required>
  Expected output format. Can be a type string or Pydantic model.
</ParamField>

<ParamField path="extraction_instruction" type="str" required>
  Natural language instruction describing what to verify.
</ParamField>

### Example Usage

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.assertion_action import AssertionAction, LLMAssertion

# Verify login success
ActionNode(
    assertion_action=AssertionAction(
        llm=LLMAssertion(
            source=["axtree"],
            output_format="str",
            extraction_instruction="Verify that the user is logged in by checking for a dashboard or welcome message",
        )
    )
)

# Verify with visual check
ActionNode(
    assertion_action=AssertionAction(
        llm=LLMAssertion(
            source=["axtree", "screenshot"],
            output_format="str",
            extraction_instruction="Verify that the order confirmation page is displayed with a green checkmark",
        )
    )
)
```

---

## NetworkCallAssertion

Verify conditions based on network requests.

```python
from optexity.schema.actions.assertion_action import NetworkCallAssertion

NetworkCallAssertion(
    url_pattern="https://api.example.com/status",
    header_filter={"content-type": "application/json"},
)
```

### Properties

<ParamField path="url_pattern" type="str | None" default="None">
  URL pattern to match. Checks if a matching request was made.
</ParamField>

<ParamField path="header_filter" type="dict[str, str] | None" default="None">
  Headers that must be present in the request/response.
</ParamField>

### Example Usage

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.assertion_action import AssertionAction, NetworkCallAssertion

# Verify API call was made
ActionNode(
    assertion_action=AssertionAction(
        network_call=NetworkCallAssertion(
            url_pattern="https://api.example.com/submit"
        )
    )
)

# Verify JSON response received
ActionNode(
    assertion_action=AssertionAction(
        network_call=NetworkCallAssertion(
            url_pattern="/api/v1/order",
            header_filter={"content-type": "application/json"}
        )
    )
)
```

---

## PythonScriptAssertion

Run custom Python code to verify conditions.

```python
from optexity.schema.actions.assertion_action import PythonScriptAssertion

PythonScriptAssertion(
    script='''
# Check if success message is present
success = await page.query_selector(".success-message")
assert success is not None, "Success message not found"
'''
)
```

### Properties

<ParamField path="script" type="str" required>
  Python code to execute. Cannot be empty.
  
  The script runs in an async context with access to the Playwright `page` object.
  Use assertions to verify conditions.
</ParamField>

### Available Objects

| Object | Description |
|--------|-------------|
| `page` | Playwright Page object |

### Example Usage

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.assertion_action import AssertionAction, PythonScriptAssertion

# Verify element exists
ActionNode(
    assertion_action=AssertionAction(
        python_script=PythonScriptAssertion(
            script='''
element = await page.query_selector("#confirmation-number")
assert element is not None, "Confirmation number not found"

text = await element.text_content()
assert text.startswith("CONF-"), f"Invalid confirmation format: {text}"
'''
        )
    )
)

# Verify URL contains expected path
ActionNode(
    assertion_action=AssertionAction(
        python_script=PythonScriptAssertion(
            script='''
assert "/dashboard" in page.url, f"Not on dashboard: {page.url}"
'''
        )
    )
)

# Verify count of elements
ActionNode(
    assertion_action=AssertionAction(
        python_script=PythonScriptAssertion(
            script='''
items = await page.query_selector_all(".order-item")
assert len(items) > 0, "No order items found"
print(f"Found {len(items)} order items")
'''
        )
    )
)
```

### Validation

- Script cannot be empty or only whitespace

---

## Timing Defaults

Assertion actions have special timing defaults on `ActionNode`:

| Property | Default for Assertions |
|----------|----------------------|
| `before_sleep_time` | `0.0` seconds |
| `end_sleep_time` | `0.0` seconds |

Assertions check the current state without additional waiting.

Override if you need to wait for state to stabilize:

```python
ActionNode(
    assertion_action=AssertionAction(
        llm=LLMAssertion(...)
    ),
    before_sleep_time=2.0,  # Wait for page to update
)
```

---

## Complete Examples

### Verify Login Success

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.interaction_action import (
    InteractionAction, ClickElementAction, InputTextAction
)
from optexity.schema.actions.assertion_action import AssertionAction, LLMAssertion

# Enter credentials
ActionNode(
    interaction_action=InteractionAction(
        input_text=InputTextAction(
            command="""get_by_label("Email")""",
            input_text="{email[0]}",
            prompt_instructions="Enter email",
        )
    )
),
ActionNode(
    interaction_action=InteractionAction(
        input_text=InputTextAction(
            command="""get_by_label("Password")""",
            input_text="{password[0]}",
            prompt_instructions="Enter password",
        )
    )
),
ActionNode(
    interaction_action=InteractionAction(
        click_element=ClickElementAction(
            command="""get_by_role("button", name="Sign In")""",
            prompt_instructions="Click sign in",
        )
    )
),

# Verify login was successful
ActionNode(
    assertion_action=AssertionAction(
        llm=LLMAssertion(
            source=["axtree"],
            output_format="str",
            extraction_instruction="Verify login was successful by checking for dashboard elements or welcome message. Return 'success' or describe any error message seen.",
        )
    ),
    before_sleep_time=3.0,  # Wait for page to load
),
```

### Verify Form Submission

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.assertion_action import AssertionAction, PythonScriptAssertion

# After form submission
ActionNode(
    assertion_action=AssertionAction(
        python_script=PythonScriptAssertion(
            script='''
import re

# Wait for confirmation to appear
await page.wait_for_selector(".confirmation", timeout=5000)

# Get confirmation text
confirmation = await page.text_content(".confirmation")

# Verify format
match = re.search(r"Order #(\\d+)", confirmation)
assert match, f"Could not find order number in: {confirmation}"

print(f"Order confirmed: {match.group(1)}")
'''
        )
    )
),
```

---

## Related

- [Extraction Actions Reference](/api-reference/extraction-actions-ref)
- [Best Practices Guide](/docs/best-practices)

