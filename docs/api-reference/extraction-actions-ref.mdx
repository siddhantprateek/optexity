---
title: Extraction Actions Reference
description: Complete reference for all extraction action schemas
---

This page documents all extraction action types and their parameters.

## ExtractionAction

Container for all extraction types. Exactly one extraction type must be provided.

```python
from optexity.schema.actions.extraction_action import ExtractionAction

ExtractionAction(
    llm=...,           # Exactly one of these
    network_call=...,
    python_script=...,
    screenshot=...,
)
```

### Extraction Types

Exactly one must be provided:

| Property | Type | Description |
|----------|------|-------------|
| `llm` | `LLMExtraction` | Extract data using an LLM |
| `network_call` | `NetworkCallExtraction` | Capture network request/response |
| `python_script` | `PythonScriptExtraction` | Run custom Python code |
| `screenshot` | `ScreenshotExtraction` | Capture page screenshot |

---

## LLMExtraction

Extract structured data from page content using an LLM.

```python
from optexity.schema.actions.extraction_action import LLMExtraction

LLMExtraction(
    source=["axtree"],
    extraction_format={
        "title": "str",
        "items": "List[str]",
    },
    extraction_instructions="Extract the page title and list of items",
    output_variable_names=["items"],
)
```

### Properties

<ParamField path="source" type="list[Literal['axtree', 'screenshot']]" default='["axtree"]'>
  Data sources for the LLM to analyze:
  - `"axtree"`: Accessibility tree (structured text representation)
  - `"screenshot"`: Visual screenshot of the page
  
  Can include both: `["axtree", "screenshot"]`
</ParamField>

<ParamField path="extraction_format" type="dict" required>
  Expected output structure. Keys are field names, values are type hints:
  - `"str"`: Single string value
  - `"List[str]"` or `"list[str]"`: List of strings
</ParamField>

<ParamField path="extraction_instructions" type="str" required>
  Natural language instructions for the LLM describing what to extract.
</ParamField>

<ParamField path="output_variable_names" type="list[str] | None" default="None">
  Fields to store in `generated_parameters` for use in subsequent actions.
  Must be keys from `extraction_format` with type `str` or `List[str]`.
</ParamField>

### extraction_format Examples

```python
# Single values
extraction_format={
    "title": "str",
    "price": "str",
}

# Lists
extraction_format={
    "product_ids": "List[str]",
    "categories": "list[str]",  # Both notations work
}

# Mixed
extraction_format={
    "page_title": "str",
    "items": "List[str]",
    "total_count": "str",
}
```

### Validation Rules

- `extraction_format` must be a valid dict
- `output_variable_names` entries must exist in `extraction_format`
- `output_variable_names` entries must have type `str` or `List[str]`

---

## NetworkCallExtraction

Capture data from network requests.

```python
from optexity.schema.actions.extraction_action import NetworkCallExtraction

NetworkCallExtraction(
    url_pattern="https://api.example.com/data",
    header_filter={"content-type": "application/json"},
)
```

### Properties

<ParamField path="url_pattern" type="str | None" default="None">
  URL pattern to match. Captured requests must contain this substring.
</ParamField>

<ParamField path="header_filter" type="dict[str, str] | None" default="None">
  Headers that must be present in the request/response.
</ParamField>

### Use Cases

```python
# Capture API responses
NetworkCallExtraction(
    url_pattern="https://api.example.com/orders"
)

# Capture JSON responses only
NetworkCallExtraction(
    url_pattern="https://api.example.com/",
    header_filter={"content-type": "application/json"}
)

# Capture specific endpoint
NetworkCallExtraction(
    url_pattern="/api/v1/search/results"
)
```

---

## PythonScriptExtraction

Run custom Python code for data extraction.

```python
from optexity.schema.actions.extraction_action import PythonScriptExtraction

PythonScriptExtraction(
    script='''
import re

content = await page.content()
matches = re.findall(r'Order #(\\d+)', content)
print(f"Found {len(matches)} orders")
'''
)
```

### Properties

<ParamField path="script" type="str" required>
  Python code to execute. Cannot be empty.
  
  The script runs in an async context with access to the Playwright `page` object.
</ParamField>

### Available Objects

| Object | Description |
|--------|-------------|
| `page` | Playwright Page object |

### Common Operations

```python
# Get page content
content = await page.content()

# Get current URL
url = page.url

# Evaluate JavaScript
result = await page.evaluate("document.title")

# Query elements
elements = await page.query_selector_all(".item")

# Get text content
text = await page.text_content("h1")
```

### Validation

- Script cannot be empty or only whitespace

---

## ScreenshotExtraction

Capture a screenshot of the page.

```python
from optexity.schema.actions.extraction_action import ScreenshotExtraction

ScreenshotExtraction(
    filename="confirmation.png",
    full_page=True,
)
```

### Properties

<ParamField path="filename" type="str" required>
  Output filename for the screenshot. Supports variable substitution.
</ParamField>

<ParamField path="full_page" type="bool" default="True">
  Capture mode:
  - `True`: Capture entire scrollable page
  - `False`: Capture only visible viewport
</ParamField>

### Filename Patterns

```python
# Static filename
filename="screenshot.png"

# With variable
filename="order_{order_id[0]}.png"

# With timestamp (in script)
filename="capture_2024_01_15.png"
```

---

## Timing Defaults

Extraction actions have special timing defaults on `ActionNode`:

| Property | Default for Extractions |
|----------|------------------------|
| `before_sleep_time` | `3.0` seconds |
| `end_sleep_time` | `0.0` seconds |

This gives pages time to fully load before extraction.

Override when needed:

```python
ActionNode(
    extraction_action=ExtractionAction(
        llm=LLMExtraction(...)
    ),
    before_sleep_time=5.0,  # More time for slow pages
)
```

---

## Complete Examples

### LLM Extraction with Output Variables

```python
from optexity.schema.automation import ActionNode, ForLoopNode
from optexity.schema.actions.extraction_action import ExtractionAction, LLMExtraction

# Extract list of IDs
ActionNode(
    extraction_action=ExtractionAction(
        llm=LLMExtraction(
            source=["axtree"],
            extraction_format={
                "order_ids": "List[str]",
                "total_count": "str",
            },
            extraction_instructions="Extract all order IDs from the table",
            output_variable_names=["order_ids"],
        )
    )
),

# Use in loop
ForLoopNode(
    variable_name="order_ids",
    nodes=[...],
)
```

### Network Call Capture

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.extraction_action import ExtractionAction, NetworkCallExtraction
from optexity.schema.actions.interaction_action import InteractionAction, ClickElementAction

# Click to trigger API call
ActionNode(
    interaction_action=InteractionAction(
        click_element=ClickElementAction(
            command="""get_by_role("button", name="Load Data")""",
            prompt_instructions="Click to load data",
        )
    )
),

# Capture the API response
ActionNode(
    extraction_action=ExtractionAction(
        network_call=NetworkCallExtraction(
            url_pattern="https://api.example.com/data"
        )
    )
),
```

### Screenshot Capture

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.extraction_action import ExtractionAction, ScreenshotExtraction

# Capture full page
ActionNode(
    extraction_action=ExtractionAction(
        screenshot=ScreenshotExtraction(
            filename="full_page.png",
            full_page=True,
        )
    )
),

# Capture viewport only
ActionNode(
    extraction_action=ExtractionAction(
        screenshot=ScreenshotExtraction(
            filename="viewport.png",
            full_page=False,
        )
    )
),
```

### Python Script Processing

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.extraction_action import ExtractionAction, PythonScriptExtraction

ActionNode(
    extraction_action=ExtractionAction(
        python_script=PythonScriptExtraction(
            script='''
import json

# Get all script tags
scripts = await page.query_selector_all("script[type='application/json']")

for script in scripts:
    content = await script.text_content()
    try:
        data = json.loads(content)
        if "orderId" in data:
            print(f"Found order: {data['orderId']}")
    except json.JSONDecodeError:
        pass
'''
        )
    )
),
```

---

## Related

- [Extraction Actions Guide](/docs/extraction-actions)
- [Parameters & Variables Guide](/docs/parameters-variables)
- [Control Flow Guide](/docs/control-flow)

