---
title: Miscellaneous Actions Reference
description: Reference for PythonScriptAction and 2FA action schemas
---

This page documents the `PythonScriptAction` and `Fetch2faAction` schemas.

## PythonScriptAction

Execute custom Python code during automation.

```python
from optexity.schema.actions.misc_action import PythonScriptAction
from optexity.schema.automation import ActionNode

ActionNode(
    python_script_action=PythonScriptAction(
        execution_code='''
async def code_fn(page):
    print("Executing custom script")
    await page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
'''
    )
)
```

### Properties

<ParamField path="execution_code" type="str" required>
  Python code to execute. Must define an async function `code_fn(page)`.
</ParamField>

### Function Signature

Your code must define an async function named `code_fn` that accepts the Playwright `page` object:

```python
async def code_fn(page):
    # Your code here
    pass
```

### Available Objects

| Object | Description |
|--------|-------------|
| `page` | Playwright Page object |

### Examples

#### Scroll to Bottom

```python
PythonScriptAction(
    execution_code='''
async def code_fn(page):
    await page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
'''
)
```

#### Scroll Within Element

```python
PythonScriptAction(
    execution_code='''
async def code_fn(page):
    await page.evaluate("""
        const el = document.querySelector('mat-dialog-content');
        if (el) el.scrollTop = el.scrollHeight;
    """)
'''
)
```

#### Wait for Condition

```python
PythonScriptAction(
    execution_code='''
async def code_fn(page):
    await page.wait_for_selector(".loading", state="hidden")
    print("Loading complete")
'''
)
```

#### Execute Custom JavaScript

```python
PythonScriptAction(
    execution_code='''
async def code_fn(page):
    result = await page.evaluate("""
        () => {
            const data = window.__INITIAL_DATA__;
            return JSON.stringify(data);
        }
    """)
    print(f"Initial data: {result}")
'''
)
```

---

## Fetch2faAction

Fetch two-factor authentication codes from various sources.

```python
from optexity.schema.actions.two_factor_auth_action import Fetch2faAction
from optexity.schema.automation import ActionNode

ActionNode(
    fetch_2fa_action=Fetch2faAction(
        fetch_email_2fa_action=...,    # Exactly one of these
        fetch_totp_2fa_action=...,
        fetch_2fa_api_call_action=...,
        output_variable_name="auth_code",
    )
)
```

### Properties

<ParamField path="output_variable_name" type="str" required>
  Variable name to store the fetched 2FA code. Available as `{variable_name[0]}` in subsequent actions.
</ParamField>

### 2FA Source Types

Exactly one must be provided:

| Property | Type | Description |
|----------|------|-------------|
| `fetch_email_2fa_action` | `FetchEmail2FaAction` | Fetch from email |
| `fetch_totp_2fa_action` | `FetchTotp2FaAction` | Generate TOTP code |
| `fetch_2fa_api_call_action` | `Fetch2faApiCallAction` | Fetch from API |

---

## FetchEmail2FaAction

Fetch 2FA code from email.

```python
from optexity.schema.actions.two_factor_auth_action import FetchEmail2FaAction

FetchEmail2FaAction(
    email_address="user@example.com",
    subject="Your verification code",
    service="gmail",
)
```

### Properties

<ParamField path="email_address" type="str" required>
  Email address to check for the verification code.
</ParamField>

<ParamField path="subject" type="str" required>
  Email subject to search for. Matches emails containing this subject.
</ParamField>

<ParamField path="service" type="Literal['gmail']" required>
  Email service. Currently only `"gmail"` is supported.
</ParamField>

### How It Works

1. After `start_2fa_timer=True` is set on a click action, the timer starts
2. This action waits for an email matching the subject
3. Only emails received after the timer started are considered
4. The verification code is extracted from the email body
5. The code is stored in `output_variable_name`

### Example

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.interaction_action import (
    InteractionAction, ClickElementAction
)
from optexity.schema.actions.two_factor_auth_action import (
    Fetch2faAction, FetchEmail2FaAction
)

# Click to trigger 2FA email
ActionNode(
    interaction_action=InteractionAction(
        click_element=ClickElementAction(
            command="""get_by_role("button", name="Send Code")""",
            prompt_instructions="Click to send verification code",
        ),
        start_2fa_timer=True,  # Important: starts timing
    )
),

# Fetch code from email
ActionNode(
    fetch_2fa_action=Fetch2faAction(
        fetch_email_2fa_action=FetchEmail2FaAction(
            email_address="user@example.com",
            subject="Your verification code",
            service="gmail",
        ),
        output_variable_name="email_code",
    )
),

# Use the code
ActionNode(
    interaction_action=InteractionAction(
        input_text=InputTextAction(
            command="""get_by_label("Code")""",
            input_text="{email_code[0]}",
            prompt_instructions="Enter verification code",
        )
    )
),
```

---

## FetchTotp2FaAction

Generate a TOTP (Time-based One-Time Password) code.

```python
from optexity.schema.actions.two_factor_auth_action import FetchTotp2FaAction

FetchTotp2FaAction(
    totp_secret="JBSWY3DPEHPK3PXP",
)
```

### Properties

<ParamField path="totp_secret" type="str" required>
  Base32-encoded TOTP secret key. This is the text form of the QR code typically scanned by authenticator apps.
</ParamField>

### How It Works

1. The secret is used to generate a 6-digit TOTP code
2. TOTP codes rotate every 30 seconds
3. The generated code is stored in `output_variable_name`

### Example

```python
from optexity.schema.automation import ActionNode, Parameters, Automation
from optexity.schema.actions.two_factor_auth_action import (
    Fetch2faAction, FetchTotp2FaAction
)

automation = Automation(
    url="https://example.com",
    parameters=Parameters(
        input_parameters={
            "totp_secret": ["JBSWY3DPEHPK3PXP"],  # Pass securely
        },
        generated_parameters={
            "totp_code": [],
        },
    ),
    nodes=[
        # Generate TOTP code
        ActionNode(
            fetch_2fa_action=Fetch2faAction(
                fetch_totp_2fa_action=FetchTotp2FaAction(
                    totp_secret="{totp_secret[0]}",
                ),
                output_variable_name="totp_code",
            )
        ),
        
        # Use the code
        ActionNode(
            interaction_action=InteractionAction(
                input_text=InputTextAction(
                    command="""get_by_label("Authentication Code")""",
                    input_text="{totp_code[0]}",
                    prompt_instructions="Enter TOTP code",
                )
            )
        ),
    ],
)
```

---

## Fetch2faApiCallAction

Fetch 2FA code from a custom API endpoint.

```python
from optexity.schema.actions.two_factor_auth_action import Fetch2faApiCallAction

Fetch2faApiCallAction(
    api_call_url="https://api.example.com/get-2fa-code",
    api_call_method="POST",
    api_call_headers={
        "Authorization": "Bearer token123",
        "Content-Type": "application/json",
    },
    api_call_body={
        "account_id": "user123",
    },
)
```

### Properties

<ParamField path="api_call_url" type="str" required>
  URL of the API endpoint to call.
</ParamField>

<ParamField path="api_call_method" type="Literal['GET', 'POST']" required>
  HTTP method for the request.
</ParamField>

<ParamField path="api_call_headers" type="dict" required>
  HTTP headers to include in the request.
</ParamField>

<ParamField path="api_call_body" type="dict" required>
  Request body (for POST requests).
</ParamField>

### Variable Substitution

Headers and body support variable substitution:

```python
Fetch2faApiCallAction(
    api_call_url="https://api.example.com/2fa",
    api_call_method="POST",
    api_call_headers={
        "Authorization": "Bearer {api_token[0]}",
    },
    api_call_body={
        "user_id": "{user_id[0]}",
    },
)
```

### Example

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.two_factor_auth_action import (
    Fetch2faAction, Fetch2faApiCallAction
)

ActionNode(
    fetch_2fa_action=Fetch2faAction(
        fetch_2fa_api_call_action=Fetch2faApiCallAction(
            api_call_url="https://internal.company.com/2fa/generate",
            api_call_method="POST",
            api_call_headers={
                "X-API-Key": "{internal_api_key[0]}",
                "Content-Type": "application/json",
            },
            api_call_body={
                "service": "login",
                "account": "{account_id[0]}",
            },
        ),
        output_variable_name="api_code",
    )
),
```

---

## Timing Defaults

These actions have special timing defaults on `ActionNode`:

| Action Type | `before_sleep_time` | `end_sleep_time` |
|-------------|---------------------|------------------|
| `python_script_action` | `0.0` | `1.0` |
| `fetch_2fa_action` | `0.0` | `0.0` |

---

## Validation Rules

### PythonScriptAction

- `execution_code` must contain valid Python code

### Fetch2faAction

- Exactly one of the 2FA source types must be provided
- `output_variable_name` is required

### FetchEmail2FaAction

- `service` must be `"gmail"` (only supported option)
- Requires `start_2fa_timer=True` to be set on a preceding action

---

## Related

- [Two-Factor Auth Guide](/docs/two-factor-auth)
- [Parameters & Variables Guide](/docs/parameters-variables)
- [Interaction Actions Reference](/api-reference/interaction-actions-ref)

