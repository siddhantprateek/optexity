---
title: Automation Schema
description: Complete reference for Automation, ActionNode, and control flow schemas
---

This page documents the core schema types used to define Optexity automations.

## Automation

The top-level container for a browser automation workflow.

```python
from optexity.schema.automation import Automation, Parameters

automation = Automation(
    url="https://example.com",
    parameters=Parameters(
        input_parameters={"key": ["value"]},
        generated_parameters={},
    ),
    nodes=[...],
)
```

### Properties

<ParamField path="url" type="str" required>
  The starting URL where the browser navigates when the automation begins.
</ParamField>

<ParamField path="parameters" type="Parameters" required>
  Container for input and generated parameters.
</ParamField>

<ParamField path="nodes" type="list[ActionNode | ForLoopNode | IfElseNode]" required>
  Ordered list of nodes to execute. Nodes are processed sequentially.
</ParamField>

---

## Parameters

Container for automation variables.

```python
from optexity.schema.automation import Parameters

params = Parameters(
    input_parameters={
        "username": ["user@example.com"],
        "search_terms": ["laptop", "monitor"],
    },
    generated_parameters={
        "order_ids": [],
    },
)
```

### Properties

<ParamField path="input_parameters" type="dict[str, list[str]]" required>
  Values provided before execution. Keys are variable names, values are lists of strings.
</ParamField>

<ParamField path="generated_parameters" type="dict[str, list[str]]" required>
  Placeholders for values extracted during execution. Initially empty lists.
</ParamField>

---

## ActionNode

Represents a single atomic action in the automation.

```python
from optexity.schema.automation import ActionNode
from optexity.schema.actions.interaction_action import InteractionAction, ClickElementAction

node = ActionNode(
    interaction_action=InteractionAction(
        click_element=ClickElementAction(
            command="""get_by_role("button", name="Submit")""",
            prompt_instructions="Click submit",
        )
    ),
    before_sleep_time=0.0,
    end_sleep_time=1.0,
    expect_new_tab=False,
)
```

### Action Type Properties

Exactly one of these must be provided:

<ParamField path="interaction_action" type="InteractionAction | None" default="None">
  User interaction: click, type, select, scroll, navigate, etc.
</ParamField>

<ParamField path="assertion_action" type="AssertionAction | None" default="None">
  Verify conditions on the page.
</ParamField>

<ParamField path="extraction_action" type="ExtractionAction | None" default="None">
  Extract data from the page via LLM, network calls, or screenshots.
</ParamField>

<ParamField path="python_script_action" type="PythonScriptAction | None" default="None">
  Execute custom Python code.
</ParamField>

<ParamField path="fetch_2fa_action" type="Fetch2faAction | None" default="None">
  Fetch two-factor authentication codes.
</ParamField>

### Timing Properties

<ParamField path="before_sleep_time" type="float" default="0.0 (3.0 for extractions)">
  Seconds to wait before executing the action. Must be between 0 and 10.
</ParamField>

<ParamField path="end_sleep_time" type="float" default="1.0 (0.0 for extractions/assertions/2FA)">
  Seconds to wait after the action completes. Must be between 0 and 10.
</ParamField>

<ParamField path="expect_new_tab" type="bool" default="False">
  Whether this action is expected to open a new browser tab. Only valid for interaction actions.
</ParamField>

<ParamField path="max_new_tab_wait_time" type="float" default="0.0 (10.0 if expect_new_tab=True)">
  Maximum seconds to wait for a new tab to appear. Must be between 0 and 10.
</ParamField>

### Validation Rules

- Exactly one action type must be provided (not zero, not multiple)
- `expect_new_tab` can only be `True` for interaction actions
- When `expect_new_tab=True`, `max_new_tab_wait_time` is automatically set to 10.0

---

## ForLoopNode

Iterates over values in a variable.

```python
from optexity.schema.automation import ForLoopNode, ActionNode

loop = ForLoopNode(
    variable_name="order_ids",
    nodes=[
        ActionNode(...),
        ActionNode(...),
    ],
)
```

### Properties

<ParamField path="variable_name" type="str" required>
  Name of the variable to iterate over. The variable must be populated before the loop executes.
</ParamField>

<ParamField path="nodes" type="list[ActionNode]" required>
  Actions to execute for each iteration. Inside these nodes, use `{variable_name[index]}` to reference the current value.
</ParamField>

### How Iteration Works

Given `order_ids = ["A", "B", "C"]`:

| Iteration | `index` value | `{order_ids[index]}` |
|-----------|---------------|----------------------|
| 1 | 0 | "A" |
| 2 | 1 | "B" |
| 3 | 2 | "C" |

---

## IfElseNode

Conditional execution based on a condition.

```python
from optexity.schema.automation import IfElseNode, ActionNode

conditional = IfElseNode(
    condition="has_captcha",
    if_nodes=[
        ActionNode(...),  # Execute if true
    ],
    else_nodes=[
        ActionNode(...),  # Execute if false
    ],
)
```

### Properties

<ParamField path="condition" type="str" required>
  Condition string to evaluate.
</ParamField>

<ParamField path="if_nodes" type="list[ActionNode]" required>
  Actions to execute when condition is true.
</ParamField>

<ParamField path="else_nodes" type="list[ActionNode]" default="[]">
  Actions to execute when condition is false. Can be empty.
</ParamField>

---

## Variable Substitution

Variables are substituted using the `{variable_name[index]}` syntax.

### Syntax

```
{variable_name[index]}
```

- `variable_name`: Key from `input_parameters` or `generated_parameters`
- `index`: Integer index (0-based) or the literal `index` inside loops

### Examples

```python
# Access first value
"{username[0]}"

# Access second value  
"{items[1]}"

# Inside ForLoopNode, current iteration value
"{order_ids[index]}"
```

### Supported Fields

Variable substitution works in:

- `input_text`
- `prompt_instructions`
- `command`
- `xpath`
- `select_values`
- `task` (agentic)
- `download_filename`
- `file_path`

---

## Complete Example

```python
from optexity.schema.automation import (
    Automation, ActionNode, ForLoopNode, Parameters
)
from optexity.schema.actions.interaction_action import (
    InteractionAction, ClickElementAction, InputTextAction, GoBackAction
)
from optexity.schema.actions.extraction_action import (
    ExtractionAction, LLMExtraction
)

automation = Automation(
    url="https://orders.example.com",
    parameters=Parameters(
        input_parameters={
            "username": ["admin@example.com"],
            "password": ["secret123"],
        },
        generated_parameters={
            "order_ids": [],
        },
    ),
    nodes=[
        # Login
        ActionNode(
            interaction_action=InteractionAction(
                input_text=InputTextAction(
                    command="""get_by_label("Email")""",
                    input_text="{username[0]}",
                    prompt_instructions="Enter email",
                )
            )
        ),
        ActionNode(
            interaction_action=InteractionAction(
                input_text=InputTextAction(
                    command="""get_by_label("Password")""",
                    input_text="{password[0]}",
                    prompt_instructions="Enter password",
                )
            )
        ),
        ActionNode(
            interaction_action=InteractionAction(
                click_element=ClickElementAction(
                    command="""get_by_role("button", name="Sign In")""",
                    prompt_instructions="Click sign in",
                )
            )
        ),
        
        # Extract order IDs
        ActionNode(
            extraction_action=ExtractionAction(
                llm=LLMExtraction(
                    source=["axtree"],
                    extraction_format={"order_ids": "List[str]"},
                    extraction_instructions="Extract all order IDs",
                    output_variable_names=["order_ids"],
                )
            )
        ),
        
        # Process each order
        ForLoopNode(
            variable_name="order_ids",
            nodes=[
                ActionNode(
                    interaction_action=InteractionAction(
                        click_element=ClickElementAction(
                            command="""get_by_text("{order_ids[index]}")""",
                            prompt_instructions="Click order {order_ids[index]}",
                        )
                    )
                ),
                ActionNode(
                    extraction_action=ExtractionAction(
                        llm=LLMExtraction(
                            source=["axtree"],
                            extraction_format={"status": "str", "total": "str"},
                            extraction_instructions="Extract order status and total",
                        )
                    )
                ),
                ActionNode(
                    interaction_action=InteractionAction(
                        go_back=GoBackAction()
                    )
                ),
            ],
        ),
    ],
)
```

## Related

- [InteractionAction Reference](/api-reference/interaction-actions-ref)
- [ExtractionAction Reference](/api-reference/extraction-actions-ref)
- [Core Concepts Guide](/docs/core-concepts)

